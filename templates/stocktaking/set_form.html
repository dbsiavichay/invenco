{% extends 'base.html' %}
{% load staticfiles %}
{% block page_title %}Conjuntos{% endblock %}

{% block content %}
<div class="row">
	<div class="col-xs-12">
      	<div class="card">
        	<div class="card-header">AÃ±adir conjunto</div>
        	<div class="card-body">
        		{% load widget_tweaks %}
        		<form id="form" class="form form-horizontal" action="" method="POST" enctype="multipart/form-data" novalidate>
        			{% csrf_token %}
				    <div class="form-group {% if form.name.errors %} has-error {% endif %}">
				        <label class="col-md-3 control-label" for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
				        <div class="col-md-9">
					        {{ form.name|add_class:"form-control"|attr:"autofocus" }}
					        {% for error in form.name.errors %}
							<span class="help-block">{{ error }}</span>
							{% endfor %}					    
				        </div>
				    </div>

				    <div class="form-group {% if form.icon.errors %} has-error {% endif %}">
				        <label class="col-md-3 control-label" for="{{ form.icon.id_for_label }}">{{ form.icon.label }}</label>
				        <div class="col-md-9">
					        {{ form.icon|add_class:"form-control" }}
					        {% for error in form.icon.errors %}
							<span class="help-block">{{ error }}</span>
							{% endfor %}					    
				        </div>
				    </div>

				    <div class="form-group {% if form.types.errors %} has-error {% endif %}">
				        <label class="col-md-3 control-label" for="{{ form.types.id_for_label }}">{{ form.types.label }}</label>
				        <div class="col-md-9">
					        {{ form.types|add_class:"form-control" }}
					        {% for error in form.types.errors %}
							<span class="help-block">{{ error }}</span>
							{% endfor %}					    
				        </div>
				    </div>


				    <table class="table">
					    <thead>
					        <tr>				          
					          <th>Tipo</th>
					          <th>Orden</th>
					          <th>Principal?</th>
					          <th>Eliminar?</th>
					        </tr>
					    </thead>
					    <tbody>
					    	{{ formset.management_form }}                                
                            {% for form in formset %}
                            {{ form.id }}    					    	
					        <tr class="inline {{ formset.prefix }}">					        
						        <td>{{ form.type|add_class:"select2" }}</td>
						        <td class="col-xs-2">{{ form.order|add_class:"form-control" }}</td>
						        <td class="col-xs-2">
						        	<div class="checkbox">
									    {{ form.is_primary }}
									    <label for="{{ form.is_primary.id_for_label }}"></label>
									</div>
						        </td>
						        <td class="col-xs-2">
						        	<div class="checkbox">
									    {{ form.DELETE }}
									    <label for="{{ form.DELETE.id_for_label }}"></label>
									</div>				        	
						       	</td>
					        </tr>					        
					        {% endfor %}
					    </tbody>
				    </table>

				</form>
				<form id="delete" action="/set/{{ set.id }}/delete/" method="POST">{% csrf_token %}</form>
				<div class="form form-horizontal">
					<div class="form-footer">
					    <div class="form-group">
					      <div class="col-md-9">
					        <button type="submit" form="form" class="btn btn-primary">
					        	<span class="fa fa-floppy-o"></span>
					        	Guardar
					        </button>		
					        {% if object %}
					        <button type="submit" form="delete" class="btn btn-danger">
					        	<span class="fa fa-trash"></span>
					        	Eliminar
					        </button>
					        {% endif %}			        
					        <a href="/set/" class="btn btn-default">
					        	<span class="fa fa-reply"></span>
					        	Regresar
					        </a>
					      </div>
					    </div>
					</div>
				</div>
        	</div>
        </div>
    </div>
</div>
{% endblock %}

{% block customjs %}
<script src="{% static 'plugins/jquery.formset.js' %}"></script>    
<script type="text/javascript">
    $(function() {
        $(".inline.{{ formset.prefix }}").formset({
            prefix: "{{ formset.prefix }}",
            addText: '<span class="fa fa-plus"></span> Agregar linea adicional',
            deleteCssClass: 'btn btn-danger btn-xs pull-right',
            deleteText: '<span class="fa fa-close"></span>',
            added: function (row) {
            	var last = $('.inline.{{ formset.prefix }}').last()[0]            	

            	$(last).find('span.select2').remove();
            	$(last).find('select.select2').removeClass('select2-hidden-accessible');
            	$(last).find('select.select2').select2();            	
            }
        });        
    })
</script>
{% endblock %}